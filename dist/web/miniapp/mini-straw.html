<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>稻草人图床神器小程序 | 七七九九六</title>
    <meta name="description" content="个人网站">
    <link rel="icon" href="/logo.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.aca50b0a.css" as="style"><link rel="preload" href="/assets/js/app.0cee35f0.js" as="script"><link rel="preload" href="/assets/js/2.78f23174.js" as="script"><link rel="preload" href="/assets/js/26.6b382647.js" as="script"><link rel="prefetch" href="/assets/js/10.fc139a1b.js"><link rel="prefetch" href="/assets/js/11.0c24bb64.js"><link rel="prefetch" href="/assets/js/12.a67458e0.js"><link rel="prefetch" href="/assets/js/13.9c237e8d.js"><link rel="prefetch" href="/assets/js/14.b582099b.js"><link rel="prefetch" href="/assets/js/15.729c2ffd.js"><link rel="prefetch" href="/assets/js/16.c8ac7939.js"><link rel="prefetch" href="/assets/js/17.dbf42153.js"><link rel="prefetch" href="/assets/js/18.c80dbf25.js"><link rel="prefetch" href="/assets/js/19.26f8708c.js"><link rel="prefetch" href="/assets/js/20.278bee0a.js"><link rel="prefetch" href="/assets/js/21.05adcccb.js"><link rel="prefetch" href="/assets/js/22.dca709f8.js"><link rel="prefetch" href="/assets/js/23.af8b2a3e.js"><link rel="prefetch" href="/assets/js/24.ae69e687.js"><link rel="prefetch" href="/assets/js/25.6e9c4eab.js"><link rel="prefetch" href="/assets/js/27.2f508fa3.js"><link rel="prefetch" href="/assets/js/28.52a2c94b.js"><link rel="prefetch" href="/assets/js/3.f08f183e.js"><link rel="prefetch" href="/assets/js/4.1b2928d7.js"><link rel="prefetch" href="/assets/js/5.a80eb1ab.js"><link rel="prefetch" href="/assets/js/6.168d2d4d.js"><link rel="prefetch" href="/assets/js/7.755fd1f5.js"><link rel="prefetch" href="/assets/js/8.5ddf5166.js"><link rel="prefetch" href="/assets/js/9.bfe5ed02.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aca50b0a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">七七九九六</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/project/" class="nav-link">项目</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">服务器</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/server/elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/server/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/server/mysql/" class="nav-link">Mysql</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/miniapp/" class="nav-link router-link-active">小程序</a></li><li class="dropdown-item"><!----> <a href="/web/vue/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/w77996" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/project/" class="nav-link">项目</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">服务器</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/server/elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/server/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/server/mysql/" class="nav-link">Mysql</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/miniapp/" class="nav-link router-link-active">小程序</a></li><li class="dropdown-item"><!----> <a href="/web/vue/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/w77996" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/web/miniapp/mini-straw.html" class="active sidebar-link">稻草人图床神器小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#项目结构" class="sidebar-link">项目结构</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#开屏页" class="sidebar-link">开屏页</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_1-判断网络状态" class="sidebar-link">1.判断网络状态</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_2-判断授权状态" class="sidebar-link">2.判断授权状态</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_3-跳转页面" class="sidebar-link">3.跳转页面</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#授权页" class="sidebar-link">授权页</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#主页" class="sidebar-link">主页</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_1-图片按钮插槽组件" class="sidebar-link">1. 图片按钮插槽组件</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_2-上传文件" class="sidebar-link">2. 上传文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#列表页" class="sidebar-link">列表页</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_1-search组件的显示和隐藏" class="sidebar-link">1.search组件的显示和隐藏</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_2-文件列表" class="sidebar-link">2.文件列表</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#我的页面" class="sidebar-link">我的页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_1-意见和建议" class="sidebar-link">1.意见和建议</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_2-小程序客服" class="sidebar-link">2.小程序客服</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#_3-小程序分享" class="sidebar-link">3.小程序分享</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#动画" class="sidebar-link">动画</a></li><li class="sidebar-sub-header"><a href="/web/miniapp/mini-straw.html#部署" class="sidebar-link">部署</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="稻草人图床神器小程序"><a href="#稻草人图床神器小程序" aria-hidden="true" class="header-anchor">#</a> 稻草人图床神器小程序</h1> <h2 id="项目结构"><a href="#项目结构" aria-hidden="true" class="header-anchor">#</a> 项目结构</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>mini-straw
    ├── component -- 组件
    |    ├── file -- 文件组件
    |    ├── image-button -- 图片按钮组件
    |    ├── search -- 查找页面组件
    |    ├── tag -- 标签组件
    ├── images -- 图片目录
    |    ├── icon -- icon图片
    |    ├── tab -- tab图片
    ├── model -- 封装的model
    ├── pages -- 页面
    |    ├── about -- 关于页
    |    ├── auth -- 授权页
    |    ├── file -- 文件页
    |    ├── index -- 首页
    |    ├── launch -- 启动页面
    |    ├── my -- 个人中心
    └── utils -- 工具

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="开屏页"><a href="#开屏页" aria-hidden="true" class="header-anchor">#</a> 开屏页</h2> <h3 id="_1-判断网络状态"><a href="#_1-判断网络状态" aria-hidden="true" class="header-anchor">#</a> 1.判断网络状态</h3> <p>使用<code>wx.getNetworkType({})</code>可获取当前网络状态，<code>networkType</code>值<code>wifi/2g/3g/4g/unknown(Android下不常见的网络类型)/none(无网络)</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code> //判断网络状态
wx.getNetworkType({
    success: res =&gt; {
    if (res.networkType == &quot;none&quot;) {
        wx.showToast({
            title: '嗷~~网络不可用',
            icon: 'none',
            duration: 2000
        })
        return;
    }
    },
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_2-判断授权状态"><a href="#_2-判断授权状态" aria-hidden="true" class="header-anchor">#</a> 2.判断授权状态</h3> <p>使用<code>wx.getSetting({})</code>获取授权状态，在获得<code>data</code>后取<code>data.authSetting['scope.userInfo']</code>判断授权状态</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> // 获取授权的状态
wx.getSetting({
    success: data =&gt; {
    if (data.authSetting['scope.userInfo']) {
        //已授权，执行登陆
        wx.getUserInfo({
            success: data =&gt; {
                    console.log(&quot;userInfo {}&quot;, data)
                    let userInfo = data.userInfo;
                    wx.setStorageSync('userInfo', userInfo);
                    //执行登陆操作
                    this._userLoginGetCode(userInfo);
            }
        });
        wx.setStorageSync('authorized', true);
    } else {
        console.log(&quot;未授权&quot;)
        //跳转至授权页
        let timer = setTimeout(() =&gt; {
                wx.redirectTo({
                        url: '/pages/auth/auth'
                })
        }, 2000)

    }
    }
});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>若授权，则调用<code>wx.getUserInfo({})</code>获取微信用户信息，信息获取完成后调用<code>wx.login({})</code>获取小程序的<code>code</code>,通过<code>code</code>向后台获取用户openId及token。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//后台获取code
_userLoginGetCode(userInfo) {
    console.log(&quot;发起_userLoginGetCode请求&quot;);
    wx.login({
        success(res) {
        console.log(&quot;wx.login {}&quot;, res);
        if (res.code) {
            // 发起网络请求
            const code = res.code;
            userInfo.code = code;
            userModel.getTokenByCode(userInfo).then((res) =&gt; {
                console.log(&quot;userModel getUserInfo {}&quot;, res);
                wx.setStorageSync(&quot;token&quot;, res.data.data.token);
                let timer = setTimeout(() =&gt;
                    wx.switchTab({
                            url: '/pages/index/index',
                    }), 2000)
            });
        } else {
                console.log('登录失败！' + res.errMsg)
        }
        }
    })
},
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_3-跳转页面"><a href="#_3-跳转页面" aria-hidden="true" class="header-anchor">#</a> 3.跳转页面</h3> <ul><li>跳转<code>/pages/auth/auth</code>页面使用的是<code>wx.redirectTo({})</code></li> <li>跳转<code>/pages/index/index</code>页面使用的是<code>wx.switchTab({})</code><br>
因为<code>/pages/index/index</code>是小程序tab页，使用<code>wx.redirectTo({})</code>无法跳转</li></ul> <h2 id="授权页"><a href="#授权页" aria-hidden="true" class="header-anchor">#</a> 授权页</h2> <p>授权需制定button按钮，加入<code>open-type='getUserInfo'</code>属性，<code>bindgetuserinfo</code>调用自定义方法<code>onGetUserInfo</code>。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> &lt;button class=&quot;auth-button&quot; open-type='getUserInfo' bindgetuserinfo=&quot;onGetUserInfo&quot;&gt;好的&lt;/button&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>onGetUserInfo</code>接受授权状态及授权获取的用户信息，再进行<code>code</code>获取，通过<code>code</code>向后台获取用户openId及token。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>onGetUserInfo: function(e) {
    console.log(e)
    const userInfo = e.detail.userInfo;
    if (userInfo) {
            //通过`code`向后台获取用户openId及token。
            this._userLoginGetCode(userInfo);
    }
},
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="主页"><a href="#主页" aria-hidden="true" class="header-anchor">#</a> 主页</h2> <h3 id="_1-图片按钮插槽组件"><a href="#_1-图片按钮插槽组件" aria-hidden="true" class="header-anchor">#</a> 1. 图片按钮插槽组件</h3> <p>在<code>component</code>目录下的<code>images-button</code>组件，做了简单的图片插槽统一，在分享按钮，用户登录按钮，文件上传按钮均可以使用。<code>plain=&quot;true&quot;</code>代表button背景透明</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;button  open-type=&quot;{{openType}}&quot; plain=&quot;{{true}}&quot; class=&quot;container&quot;&gt;
  &lt;slot name=&quot;img&quot;&gt;&lt;/slot&gt;
&lt;/button&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>options</code>需要开启插槽功能，添加<code>multipleSlots: true</code><br> <code>open-type=&quot;&quot;</code>父组件将参数传入子组件，子组件在<code>properties</code>属性中可以获取到父组件传来的openType数据，通过<code>this.properties.openType</code>可以获取属性值</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>options: {
    // 开启插槽
    multipleSlots: true
  },
/**
   * 组件的属性列表
   */
  properties: {
    openType: {
      type: String
    }
  },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>index</code>页面引入组件，需要在<code>index.json</code>中添加组件路径</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;usingComponents&quot;: {
    &quot;btn-cmp&quot;: &quot;/component/image-button/index&quot;
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-上传文件"><a href="#_2-上传文件" aria-hidden="true" class="header-anchor">#</a> 2. 上传文件</h3> <p>主要使用到<code>wx.chooseImage({})</code>进行图片的选择，选择后使用<code>wx.uploadFile({})</code>上传图片至服务器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//上传文件
onUpload(event) {
let _this = this;
wx.chooseImage({
  count: 1, // 默认9
  sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
  sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
  success: function(res) {
    // 返回选定照片的本地文件路径列表，tempFilePath可以作为img标签的src属性显示图片
    let tempFilePaths = res.tempFilePaths;
    console.log(tempFilePaths)
    wx.uploadFile({
      header: {
        &quot;Authorization&quot;: &quot;Bearer &quot; + wx.getStorageSync(&quot;token&quot;)
      },
      url: config.apiBaseUrl + '/file/upload',
      filePath: tempFilePaths[0],
      name: 'file',
      success: (res) =&gt; {
        wx.showToast({
          title: &quot;上传成功~&quot;,
          icon: 'none',
          duration: 2000
        })
      },
      fail: (res) =&gt; {
        wx.showToast({
          title: res.data.msg,
          icon: 'none',
          duration: 2000
        })
      }
    })

  }
})
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="列表页"><a href="#列表页" aria-hidden="true" class="header-anchor">#</a> 列表页</h2> <h3 id="_1-search组件的显示和隐藏"><a href="#_1-search组件的显示和隐藏" aria-hidden="true" class="header-anchor">#</a> 1.search组件的显示和隐藏</h3> <p>固定列表页搜索header位置，点击header显示<code>search</code>组件，在<code>search</code>组件点击取消则隐藏<code>search</code>组件，此处设计子组件向父组件传递消息</p> <ul><li>引入search组件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> &quot;usingComponents&quot;: {
    ...
    &quot;search-cmp&quot;: &quot;/component/search/index&quot;
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>使用searchPage参数判断<code>search</code>组件的,默认为false,在点击header时更新searchPage为true,显示<code>search</code>组件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;view wx:if=&quot;{{!searchPage}}&quot; class=&quot;container&quot;&gt;
  ...
&lt;/view&gt;

&lt;search-cmp  wx:if=&quot;{{searchPage}}&quot; &gt;&lt;/search-cmp&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>search</code>页面点击取消，向父组件发送一个<code>this.triggerEvent('cancel', {}, {});</code>事件，在xml中的<code>search-cmp</code>添加<code>cancel</code>事件的通知绑定</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>#file页面中的search-cmp组件
&lt;search-cmp  wx:if=&quot;{{searchPage}}&quot; bind:cancel=&quot;onCancel&quot;&gt;&lt;/search-cmp&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>父组件<code>file</code>页面绑定子组件传来的<code>cancel</code>事件通知，就调用<code>onCancel</code>方法,
在<code>onCancel</code>方法中获取事件响应，将<code>searchPage</code>参数修改为false，<code>search</code>组件就隐藏起来了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//cancel searching page 
onCancel(event) {
  console.info(event)
  this.triggerEvent('cancel', {}, {});
 
},
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-文件列表"><a href="#_2-文件列表" aria-hidden="true" class="header-anchor">#</a> 2.文件列表</h3> <h4 id="_1-获取列表信息传递给file组件"><a href="#_1-获取列表信息传递给file组件" aria-hidden="true" class="header-anchor">#</a> 1.获取列表信息传递给file组件</h4> <p>在<code>page</code>中的file页面，获取到后台传来的fileList数据，引入file组件，<code>file=&quot;&quot;</code>将数据传入子组件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;view wx:if=&quot;{{fileList}}&quot;&gt;
  &lt;block wx:for=&quot;{{fileList}}&quot; wx:key=&quot;{{item.id}}&quot; file=&quot;{{item}}&quot;&gt;
    &lt;file-cmp file=&quot;{{item}}&quot; bind:del=&quot;onDelete&quot;&gt;&lt;/file-cmp&gt;
    &lt;view class=&quot;line&quot;&gt;&lt;/view&gt;
  &lt;/block&gt;
&lt;/view&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在<code>component</code>中的file组件，在<code>properties</code>添加属性<code>file</code>来接收父组件传来的数据,
file的组件在xml页面中使用file.fileName即可获取到对象信息，相应的数据也会呈现在页面上</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  /**
   * 组件的属性列表
   */
  properties: {
    file: Object
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-粘贴板操作"><a href="#_2-粘贴板操作" aria-hidden="true" class="header-anchor">#</a> 2.粘贴板操作</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;image src=&quot;images/copy.png&quot; bindtap=&quot;onCopy&quot;&gt;&lt;/image&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>图片点击响应方法<code>onCopy</code>，<code>onCopy</code>调用<code>wx.setClipboardData({})</code>可以将数据复制到粘贴板</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    
    onCopy: function (event) {
      console.info(event)
      let _this = this;
      wx.setClipboardData({
        data: _this.properties.file.filePath,
        success: function(res) {
          wx.showToast({
            title: '图片地址复制成功',
          })
        }
      });

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-删除操作"><a href="#_3-删除操作" aria-hidden="true" class="header-anchor">#</a> 3.删除操作</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;image src=&quot;images/del.png&quot; bindtap=&quot;onDelete&quot;&gt;&lt;/image&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>子组件将数据传递给父组件，点击删除图片出发<code>onDelete</code>方法,通过<code>this.triggerEvent('del', {fileId}, {});</code>将文件ID发送到父组件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    onDelete: function (event) {
      console.info(event)
      let fileId = this.properties.file.id;
      this.triggerEvent('del', {fileId}, {});
    },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>父组件file页面绑定子组件传来的<code>del</code>事件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;file-cmp file=&quot;{{item}}&quot; bind:del=&quot;onDelete&quot;&gt;&lt;/file-cmp&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>调用<code>onDelete</code>出发网络请求去完成删除文件的逻辑,删除成功后重新刷新文件列表</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> //删除图片
onDelete(event) {
    console.info(&quot;DEL&quot;)
    console.info(event)
    let fileId = event.detail.fileId;
    fileModel.delFileById(fileId).then((res) =&gt; {
        console.info(res);
        wx.showToast({
                title: '删除成功',
        })
        this.setData({
                pageNum: 1,
                fileList: []
        });
        this._getFileList();
    })
},
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="我的页面"><a href="#我的页面" aria-hidden="true" class="header-anchor">#</a> 我的页面</h2> <h3 id="_1-意见和建议"><a href="#_1-意见和建议" aria-hidden="true" class="header-anchor">#</a> 1.意见和建议</h3> <p>小程序自带用户反馈功能，使用<code>button</code>跳转至网页，用户可以填写相关反馈,<code>open-type</code>设置为<code>feedback</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;button class=&quot;about-btn&quot; plain=&quot;true&quot; open-type=&quot;feedback&quot;&gt;
    &lt;text class=&quot;about-btn-text&quot;&gt;反馈建议&lt;/text&gt;
&lt;/button&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-小程序客服"><a href="#_2-小程序客服" aria-hidden="true" class="header-anchor">#</a> 2.小程序客服</h3> <p>小程序的<code>button</code>中的<code>open-type</code>拥有开放能力,在微信公众平台中启用客服功能，添加客服人员，在代码中添加<code>button</code>即可弹出客服聊天界面,<code>open-type</code>设置为<code>contact</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code> &lt;button class=&quot;about-btn&quot; plain=&quot;true&quot; open-type=&quot;contact&quot; bindcontact=&quot;handleContact&quot;&gt;
    &lt;text class=&quot;about-btn-text&quot;&gt;联系客服&lt;/text&gt;
&lt;/button&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-小程序分享"><a href="#_3-小程序分享" aria-hidden="true" class="header-anchor">#</a> 3.小程序分享</h3> <p>此处使用插槽,<code>button</code>中的<code>open-type</code>设置为<code>share</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;btn-cmp open-type=&quot;share&quot;&gt;
    &lt;image slot=&quot;img&quot; src=&quot;images/share.png&quot; /&gt;
&lt;/btn-cmp&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="动画"><a href="#动画" aria-hidden="true" class="header-anchor">#</a> 动画</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/wx.createAnimation.html" target="_blank" rel="noopener noreferrer">小程序动画官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
开屏动画，设置文字透明度，从0到1，渐渐显示，主要使用到<code>opacity</code>去设置组件的透明度，先创建一个动画<code>animationTip</code>,持续800ms,然后在<code>setTimeout(function () {})</code>中设置动画出现时间</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> var animationTip = wx.createAnimation({
      //持续时间800ms
      duration: 800,
      timingFunction: 'ease',
    });
    this.animationTip = animationTip;
    animationTip.opacity(0).step()
    this.setData({
      animationTip: animationTip.export()
    })
    setTimeout(function () {
      animationTip.opacity(1).step()
      this.setData({
        animationTip: animationTip.export()
      })
    }.bind(this), 500)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="部署"><a href="#部署" aria-hidden="true" class="header-anchor">#</a> 部署</h2> <ol><li>修改<code>utils</code>目录下的<code>config.apiBaseUrl</code>,改成自己的域名，上传到微信公众号平台，在版本管理中进行发布</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>const config ={
   apiBaseUrl: &quot;你自己的域名或服务器地址&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/11/2019, 5:29:37 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0cee35f0.js" defer></script><script src="/assets/js/2.78f23174.js" defer></script><script src="/assets/js/26.6b382647.js" defer></script>
  </body>
</html>
