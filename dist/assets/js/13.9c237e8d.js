(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{197:function(n,s,e){"use strict";e.r(s);var a=e(0),t=Object(a.a)({},function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"elastic-job"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elastic-job","aria-hidden":"true"}},[n._v("#")]),n._v(" elastic-job")]),n._v(" "),e("h2",{attrs:{id:"_1-pom-xml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-pom-xml","aria-hidden":"true"}},[n._v("#")]),n._v(" 1.pom.xml")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("        <elastic-job.version>2.1.5</elastic-job.version>\n        <dependency>\n            <groupId>com.dangdang</groupId>\n            <artifactId>elastic-job-lite-core</artifactId>\n            <version>${elastic-job.version}</version>\n        </dependency>\n        \x3c!-- elastic-job-lite-spring --\x3e\n        <dependency>\n            <groupId>com.dangdang</groupId>\n            <artifactId>elastic-job-lite-spring</artifactId>\n            <version>${elastic-job.version}</version>\n        </dependency>\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br")])]),e("h2",{attrs:{id:"_2-定义zookeeper"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-定义zookeeper","aria-hidden":"true"}},[n._v("#")]),n._v(" 2.定义zookeeper")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('@Configuration\npublic class ElasticRegCenterConfig {\n    /**\n     * 配置zookeeper\n     * @param serverList\n     * @param namespace\n     * @return\n     */\n    @Bean(initMethod = "init")\n    public ZookeeperRegistryCenter regCenter(\n            @Value("${regCenter.serverList}") final String serverList,\n            @Value("${regCenter.namespace}") final String namespace) {\n        return new ZookeeperRegistryCenter(new ZookeeperConfiguration(serverList, namespace));\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br")])]),e("h2",{attrs:{id:"定义job"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定义job","aria-hidden":"true"}},[n._v("#")]),n._v(" 定义job")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('@Component\npublic class SimpleJobDemo implements SimpleJob {\n    @Override\n    public void execute(ShardingContext shardingContext) {\n        System.out.println(String.format("------Thread ID: %s, 任務總片數: %s, " +\n                        "当前分片項: %s.当前參數: %s," +\n                        "当前任務名稱: %s.当前任務參數: %s"\n                ,\n                Thread.currentThread().getId(),\n                shardingContext.getShardingTotalCount(),\n                shardingContext.getShardingItem(),\n                shardingContext.getShardingParameter(),\n                shardingContext.getJobName(),\n                shardingContext.getJobParameter()\n\n        ));\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br")])]),e("h2",{attrs:{id:"_4-定义任务监听器，统计每次任务执行的时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-定义任务监听器，统计每次任务执行的时间","aria-hidden":"true"}},[n._v("#")]),n._v(" 4.定义任务监听器，统计每次任务执行的时间")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('public class MyElasticJobListener implements ElasticJobListener {\n    private static final Logger logger = LoggerFactory.getLogger(MyElasticJobListener.class);\n\n    private long beginTime = 0;\n    @Override\n    public void beforeJobExecuted(ShardingContexts shardingContexts) {\n        beginTime = System.currentTimeMillis();\n\n        logger.info("===>{} JOB BEGIN TIME: {} <===",shardingContexts.getJobName(), TimeUtil.mill2Time(beginTime));\n    }\n\n    @Override\n    public void afterJobExecuted(ShardingContexts shardingContexts) {\n        long endTime = System.currentTimeMillis();\n        logger.info("===>{} JOB END TIME: {},TOTAL CAST: {} <===",shardingContexts.getJobName(), TimeUtil.mill2Time(endTime), endTime - beginTime);\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br")])]),e("h2",{attrs:{id:"_5-配置jobconfiuration，配置job随容器一起启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置jobconfiuration，配置job随容器一起启动","aria-hidden":"true"}},[n._v("#")]),n._v(" 5.配置JobConfiuration，配置job随容器一起启动")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('@Configuration\npublic class ElasticJobConfig {\n    @Autowired\n    private ZookeeperRegistryCenter regCenter;\n    /**\n     * 配置任务监听器\n     * @return\n     */\n    @Bean\n    public ElasticJobListener elasticJobListener() {\n        return new MyElasticJobListener();\n    }\n    /**\n     * 配置任务详细信息\n     * @param jobClass\n     * @param cron\n     * @param shardingTotalCount\n     * @param shardingItemParameters\n     * @return\n     */\n    private LiteJobConfiguration getLiteJobConfiguration(final Class<? extends SimpleJob> jobClass,\n                                                         final String cron,\n                                                         final int shardingTotalCount,\n                                                         final String shardingItemParameters) {\n        return LiteJobConfiguration.newBuilder(new SimpleJobConfiguration(\n                JobCoreConfiguration.newBuilder(jobClass.getName(), cron, shardingTotalCount)\n                        .shardingItemParameters(shardingItemParameters).build()\n                , jobClass.getCanonicalName())\n        ).overwrite(true).build();\n    }\n    @Bean(initMethod = "init")\n    public JobScheduler simpleJobScheduler(final SimpleJobDemo simpleJob,\n                                           @Value("${stockJob.cron}") final String cron,\n                                           @Value("${stockJob.shardingTotalCount}") final int shardingTotalCount,\n                                           @Value("${stockJob.shardingItemParameters}") final String shardingItemParameters) {\n        MyElasticJobListener elasticJobListener = new MyElasticJobListener();\n        return new SpringJobScheduler(simpleJob, regCenter,\n                getLiteJobConfiguration(simpleJob.getClass(), cron, shardingTotalCount, shardingItemParameters),\n                elasticJobListener);\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br")])]),e("h2",{attrs:{id:"配置文件如下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置文件如下","aria-hidden":"true"}},[n._v("#")]),n._v(" 配置文件如下")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("server.port=${random.int[10000,19999]}\nregCenter.serverList = localhoost:2181\nregCenter.namespace = elastic-job-lite-springboot\n\nstockJob.cron = 0/5 * * * * ?\nstockJob.shardingTotalCount = 4\nstockJob.shardingItemParameters = 0=0,1=1,2=0,3=1\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br")])]),e("p",[n._v("https://www.cnblogs.com/xmzJava/p/9838358.html")])])},[],!1,null,null,null);s.default=t.exports}}]);